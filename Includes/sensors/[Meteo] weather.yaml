###### METEO
platform: template
sensors:  
      weather_temperature:
        friendly_name: Weather Temp√©rature
        value_template: "{{ state_attr('weather.maison' , 'temperature') }}¬∞"    
      weather_alert_inondation:
        friendly_name: Alerte Inondation
        value_template: "{{ state_attr('sensor.44_weather_alert' , 'Inondation') }}"
      weather_alert_grand_froid:
        friendly_name: Alerte Grand-froid
        value_template: "{{ state_attr('sensor.44_weather_alert' , 'Grand-froid') }}"
      weather_alert_orages:
        friendly_name: Alerte Orages
        value_template: "{{ state_attr('sensor.44_weather_alert' , 'Orages') }}"
      weather_alert_pluie_inondation:
        friendly_name: Alerte Pluie-inondation
        value_template: "{{ state_attr('sensor.44_weather_alert' , 'Pluie-inondation') }}"
      weather_alert_vent_violent:
        friendly_name: Alerte Vent violent
        value_template: "{{ state_attr('sensor.44_weather_alert' , 'Vent violent') }}"       
      weather_alert_neige_verglas:
        friendly_name: Alerte Neige-verglas
        value_template: "{{ state_attr('sensor.44_weather_alert' , 'Neige-verglas') }}"
          
      weather_conditions:
        value_template: >-
          {% set temperature = states('sensor.weather_temperature') | round %}
          {% set precip = states('sensor.nantes_rain_chance') | round %}
          {% set snow = states('sensor.nantes_snow_chance') | round %}
          {% set ressenti = states('sensor.weather_ressenti') | round %}
          {% set weather_state = states('weather.nantes') 
            | replace('rainy', 'Pluvieux')
            | replace('partlycloudy', 'Un peu nuageux')
            | replace('cloudy', 'Nuageux')
            | replace('clear-night', 'Nuit claire')
            | replace('fog', 'Brouillard')
            | replace('hail', 'Gr√™le')
            | replace('lightning-rainy', 'Pluie orageuse')
            | replace('lightning', 'Orages') 
            | replace('pourring', 'Fortes pluies')
            | replace('snowy-rainy', 'Neigeux')
            | replace('snowy', 'Neigeux')
            | replace('sunny', 'Ensoleill√©')
            | replace('windy-variant', 'Venteux')
            | replace('windy', 'Venteux')
            | replace('exceptional', 'Exceptionel') %}
          
          {% if not state_attr('weather.maison', 'temperature') == 'Indisponible' -%}
            {% if states('weather.nantes') == 'lightning-rainy' -%}
              Pluies orageuses
            {% elif states.sensor.nantes_rain_chance.state | float > 0 -%}
              {{ weather_state }}
            {% else -%}
              {{ weather_state }}
            {% endif -%}
          {% else -%}
            Pas d'info...
          {% endif -%} 
          
      weather_icon:
        value_template: >-
          {% set weather_icon = states('weather.nantes') 
            | replace('rainy', '‚òîÔ∏è')
            | replace('partlycloudy', '‚õÖÔ∏è')
            | replace('cloudy', '‚òÅÔ∏è')
            | replace('clear-night', '‚ú®')
            | replace('fog', 'üåÄ')
            | replace('hail', 'üåß')
            | replace('lightning-rainy', '‚õà')
            | replace('lightning', '‚ö°Ô∏è') 
            | replace('pourring', 'Ô∏è‚òîÔ∏è')
            | replace('snowy-rainy', '‚ùÑÔ∏èÔ∏è')
            | replace('snowy', '‚ùÑÔ∏è')
            | replace('sunny', '‚òÄÔ∏è')
            | replace('windy-variant', 'üí®')
            | replace('windy', 'üí®')
            | replace('exceptional', '‚ö†Ô∏è') %}     
          {% if not state_attr('weather.maison', 'temperature') == 'Indisponible' -%}
            {% if states('weather.nantes') == 'lightning-rainy' -%}
              ‚õà
            {% else -%}
            {{ weather_icon }}
            {% endif -%}
          {% else -%}
          {% endif -%}
      weather_conditions_pluie:
        value_template: >-          
          {% set precip = states('sensor.nantes_rain_chance') | round %}
          {% if states.sensor.nantes_rain_chance.state | float > 0 -%}
            <font color='grey'><font size='2'><ha-icon icon="mdi:weather-rainy"></ha-icon> {{ precip }}%</font>
          {% else -%}
          {% endif -%}    
          
      weather_conditions_neige:
        value_template: >-          
          {% set snow = states('sensor.nantes_snow_chance') | round %}
          {% if states.sensor.nantes_snow_chance.state | float > 0 -%}
             <font color='grey'><font size='2'><ha-icon icon="mdi:snowflake"></ha-icon> {{ snow }}%</font>
          {% else -%}
          {% endif -%}  
          
      weather_conditions_ciel:
        value_template: >-        
          {% set ciel = states('sensor.nantes_cloud_cover') | round -%}
          {% if states.sensor.nantes_cloud_cover.state | float > 10 -%}
            <font color='grey'><font size='2'><ha-icon icon="mdi:weather-cloudy"></ha-icon> {{ ciel }}%</font>
          {% else -%}
          {% endif -%}          
      weather_vent:
        friendly_name: "Weather vent"
        value_template: 
          "{{ state_attr('weather.nantes' , 'wind_speed') }}"

      weather_conditions_vent:
        value_template: >-        
          {% set vent = states('sensor.weather_vent') | round -%}
          {% if states.sensor.weather_vent.state | float > 5 -%}
            <font color='grey'><font size='2'><ha-icon icon="mdi:weather-windy"></ha-icon> {{ vent }}Km/h</font>
          {% else -%}
          {% endif -%}
          
      weather_conditions_uv:
        value_template: >-        
          {% set uv = states('sensor.nantes_uv') | round -%}
          {% if states.sensor.nantes_uv.state | float > 4 -%}
            <font color='grey'><font size='2'><ha-icon icon="mdi:sunglasses"></ha-icon> UV{{ uv }}</font>
          {% else -%}
          {% endif -%}  
      weather_alerte_couleur:
        friendly_name: Alerte m√©t√©o couleur
        value_template: >-
          {% if is_state("sensor.44_weather_alert", "Jaune") -%}
             <br><font color='gold'>‚ö†Ô∏è Jaune  
          {% elif is_state("sensor.44_weather_alert", "Orange") -%}
             <br><font color='orange'>‚ö†Ô∏è Orange 
          {% elif is_state("sensor.44_weather_alert", "Rouge") -%}
             <br><font color='red'>‚ö†Ô∏è Rouge 
          {%- endif %}
        
      weather_alerte:
        friendly_name: Alerte m√©t√©o
        value_template: >-        
          {% if is_state("sensor.weather_alert_grand_froid", "Jaune") -%} ü•∂ Grand froid {%- endif %}  {% if is_state("sensor.weather_alert_neige_verglas", "Jaune") -%} ‚ùÑÔ∏è Neige / Verglas{%- endif %}  {% if is_state("sensor.weather_alert_inondation", "Jaune") -%} ‚òîÔ∏è Inondation{%- endif %}  {% if is_state("sensor.weather_alert_orages", "Jaune") -%} ‚ö°Ô∏è Orages{%- endif %}  {% if is_state("sensor.weather_alert_vent_violent", "Jaune") -%} üí® Vent violent{%- endif %}  {% if is_state("sensor.weather_alert_pluie_inondation", "Jaune") -%} üåß Pluie / Inondation{%- endif %}
          {% if is_state("sensor.weather_alert_grand_froid", "Orange") -%} ü•∂ Grand froid {%- endif %}  {% if is_state("sensor.weather_alert_neige_verglas", "Orange") -%} ‚ùÑÔ∏è Neige / Verglas{%- endif %}  {% if is_state("sensor.weather_alert_inondation", "Orange") -%} ‚òîÔ∏è Inondation{%- endif %}  {% if is_state("sensor.weather_alert_orages", "Orange") -%} ‚ö°Ô∏è Orages{%- endif %}  {% if is_state("sensor.weather_alert_vent_violent", "Orange") -%} üí® Vent violent{%- endif %}  {% if is_state("sensor.weather_alert_pluie_inondation", "Orange") -%} üåß Pluie / Inondation{%- endif %}
          {% if is_state("sensor.weather_alert_grand_froid", "Rouge") -%} ü•∂ Grand froid {%- endif %}  {% if is_state("sensor.weather_alert_neige_verglas", "Rouge") -%} ‚ùÑÔ∏è Neige / Verglas{%- endif %}  {% if is_state("sensor.weather_alert_inondation", "Rouge") -%} ‚òîÔ∏è Inondation{%- endif %}  {% if is_state("sensor.weather_alert_orages", "Rouge") -%} ‚ö°Ô∏è Orages{%- endif %}  {% if is_state("sensor.weather_alert_vent_violent", "Rouge") -%} üí® Vent violent{%- endif %}  {% if is_state("sensor.weather_alert_pluie_inondation", "Rouge") -%} üåß Pluie / Inondation{%- endif %}
        
      weather_soleil:
        friendly_name: Soleil          
        value_template: >-
          {% if is_state("sun.sun", "above_horizon") -%}
            üåô{{ as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom("%-Hh%M") }} - ‚òÄÔ∏è{{ as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom("%-Hh%M") }}
          {% else %}
            ‚òÄÔ∏è{{ as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom("%-Hh%M") }}  - üåô{{ as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom("%-Hh%M") }}
          {% endif %}
      temp_max:
        friendly_name: Temp√©rature max du jour
        value_template: "{{ states.weather.nantes.attributes.forecast[0].temperature|float|round(2) }}¬∞"  
        
        
      nantes_temperature_maximale_pour_demain:
        friendly_name: Pr√©vision temp√©rature maximale
        value_template: >-
            {% set start = (now().replace(hour=0,minute=0,second=0)) %}
            {% set end = (start + timedelta(days=2)) %}
            {{ state_attr('weather.nantes', 'forecast') | selectattr('datetime', '>', start) | selectattr('datetime','<=', end) | map(attribute='temperature') | list | max }}     
        unit_of_measurement: '¬∞C'      

      nantes_temperature_minimale_pour_demain:
        friendly_name: Pr√©vision temp√©rature minimale
        value_template: >-
            {% set start = (now().replace(hour=0,minute=0,second=0)) %}
            {% set end = (start + timedelta(days=2)) %}
            {{ state_attr('weather.nantes', 'forecast') | selectattr('datetime', '>=', start) | selectattr('datetime','<=', end) | map(attribute='templow') | list | max }} 
        unit_of_measurement: '¬∞C'      