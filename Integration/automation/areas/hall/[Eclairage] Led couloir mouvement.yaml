- id: '1647387241187'
  alias: '[Eclairage] Led couloir mouvement '
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.motion_couloir_bd_zone
    - binary_sensor.motion_couloir_hg_zone
    - binary_sensor.door_entrer
  condition:
  - condition: time
    after: '18:30:00'
    before: 06:59:00
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.motion_couloir_bd_zone
          state: 'on'
        - condition: state
          entity_id: binary_sensor.motion_couloir_hg_zone
          state: 'on'
        - condition: not
          conditions:
          - condition: and
            conditions:
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 24 Décembre
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 25 Décembre
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 14 Juillet
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 31 Octobre
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 11 Novembre
          - condition: time
            after: '18:00:00'
            before: '22:00:00'
            weekday:
            - sun
            - sat
            - fri
            - thu
            - wed
            - tue
            - mon
      sequence:
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.rainbow_strip_led
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.motion_couloir_bd_zone
          state: 'off'
        - condition: state
          entity_id: binary_sensor.motion_couloir_hg_zone
          state: 'off'

      sequence:
      - service: automation.turn_off
        data: {}
        target:
          entity_id:
          - automation.rainbow_strip_led
          - automation.eclairage_couloir_fete_national
          - automation.automation_0
          - automation.eclairage_couloir_halloween
      - service: light.turn_off
        data:
          transition: 16
        target:
          area_id: couloir
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.motion_couloir_bd_zone
          state: 'on'
        - condition: state
          entity_id: binary_sensor.motion_couloir_hg_zone
          state: 'on'

        - condition: state
          entity_id: sensor.date_simple_v2
          state: 24 Décembre
        - condition: state
          entity_id: sensor.date_simple_v2
          state: 25 Décembre
        - condition: not
          conditions:
          - condition: and
            conditions:
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 14 Juillet
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 31 Octobre
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 11 Novembre
        - condition: time
          after: '18:00:00'
          before: '22:00:00'
          weekday:
          - sun
          - sat
          - fri
          - thu
          - wed
          - tue
          - mon
      sequence:
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.automation_0
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.motion_couloir_bd_zone
          state: 'on'
        - condition: state
          entity_id: binary_sensor.motion_couloir_hg_zone
          state: 'on'

        - condition: state
          entity_id: sensor.date_simple_v2
          state: 14 Juillet
        - condition: state
          entity_id: sensor.date_simple_v2
          state: 11 Novembre
        - condition: not
          conditions:
          - condition: and
            conditions:
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 24 Décembre
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 25 Décembre
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 31 Octobre
      - condition: time
        after: '18:00:00'
        before: '22:00:00'
        weekday:
        - sun
        - sat
        - fri
        - thu
        - wed
        - tue
        - mon
      sequence:
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.eclairage_couloir_fete_national
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.motion_couloir_bd_zone
          state: 'on'
        - condition: state
          entity_id: binary_sensor.motion_couloir_hg_zone
          state: 'on'

        - condition: state
          entity_id: sensor.date_simple_v2
          state: 31 Octobre
        - condition: not
          conditions:
          - condition: and
            conditions:
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 24 Décembre
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 25 Décembre
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 14 Juillet
            - condition: state
              entity_id: sensor.date_simple_v2
              state: 11 Novembre
      - condition: time
        after: '18:00:00'
        before: '22:00:00'
        weekday:
        - sun
        - sat
        - fri
        - thu
        - wed
        - tue
        - mon
      sequence:
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.eclairage_couloir_halloween
    - conditions:
      - condition: time
        after: '22:00:00'
        before: '6:00:00'
        weekday:
        - sun
        - sat
        - fri
        - thu
        - wed
        - tue
        - mon
      sequence:
      - service: light.turn_on
        data:
          brightness_pct: '{% if (now().hour < 8) %} 35 {% elif (now().hour < 10)
            %} 50 {% elif (now().hour < 21) %} 100 {% elif (now().hour < 22) %} 40
            {% elif (now().hour < 23) or ((now().hour == 23) and (now().minute < 45))
            %} 10 {% else %} 5 {% endif%}'
        target:
          entity_id: light.led_couloir_on_off
    default: []
  mode: restart
